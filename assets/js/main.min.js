function launcher(){get("#switchLanguage").addEventListener("click",switchLanguage),get("#start").style.display="flex",get("#displayTip").innerHTML=_content.tips[rand(0,_content.tips.length)],null!=game.core.name&&""!=game.core.name?get("#nameCharacter").value=game.core.name:(get("#nameCharacter").value="",get("#nameCharacter").focus()),get("#play").addEventListener("click",function(){get("#nameCharacter").checkValidity()&&""!=get("#nameCharacter").value?startGame("new"):(get("#nameCharacterLabel").innerHTML=_content.events.nameHeroCheck,get("#nameCharacterLabel").style.color=getVariableCSS("text-error"))})}function startGame(e){get("#start").style.display="none",get("#game").style.display="flex",changeDisplay("normal-game"),createMenu(),createButtons(),checkVersion(),refreshDisplay=setInterval(displayGame,100),"new"==e?(game.core.name=get("#nameCharacter").value,game.core.ongoing=!0,playSound("Room"),get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.start+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.startGame_part1+".</p>",get("#screen").innerHTML+="<em>"+_content.events.startGame_part2+".</em>",get("#screen").innerHTML+="<p>"+_content.events.startGame_part3+".</p>"):"load"==e&&("fight"==game.events.lastAction&&"fightOver"!=game.events.subAction&&changeDisplay("normal-to-fight"),"chest"==game.events.lastAction&&"chestOver"!=game.events.subAction&&changeDisplay("normal-to-chest"),"merchant"==game.events.lastAction&&"merchantOver"!=game.events.subAction&&changeDisplay("normal-to-merchant"),get("#screen").innerHTML=game.events.currentEvent)}function playTurn(){game.events.subAction=null,game.character.room++,changeDisplay("screen-to-message"),game.character.room>10?(refreshInterval=2e3,game.character.room=1,game.character.floor++,playSound("Floor"),get("#message").innerHTML='<p class="bigger">'+_content.vocabulary.floor+" "+game.character.floor+"</p>"):(refreshInterval=1e3,game.stats.totalRoom++,playSound("Room"),get("#message").innerHTML='<p class="bigger">'+_content.vocabulary.floor+" "+parseInt(game.character.floor)+"</p>",get("#message").innerHTML+="<p>"+_content.vocabulary.room+" "+game.character.room+"</p>"),setTimeout(function(){changeDisplay("message-to-screen")},refreshInterval),choiceAction()}function choiceAction(){let e=game.character.floor>5?rand(1,5):rand(1,4);5==e?(game.events.newAction="merchant",game.events.newAction!=game.events.lastAction?merchant():choiceAction()):4==e?(game.events.newAction="spirit",game.events.newAction!=game.events.lastAction?spirit():choiceAction()):3==e?(game.events.newAction="fight",game.events.newAction!=game.events.lastAction?fight():choiceAction()):2==e?(game.events.newAction="chest",game.events.newAction!=game.events.lastAction?chest():choiceAction()):(game.events.newAction="noEvent",game.events.newAction!=game.events.lastAction?noEvent():choiceAction())}function heal(){game.character.itemHeal>0&&game.character.health<game.character.healthMax?(game.character.itemHeal--,game.character.health=game.character.healthMax,game.stats.healUsed++,playVibrate(10),playSound("Heal"),get("#screen").innerHTML+='<hr><p class="green">'+_content.events.healing+"</p>"):playVibrate(250)}function noEvent(){game.events.lastAction="noEvent",get("#screen").innerHTML='<div id="containerImage"></div>',get("#containerImage").style.background="url('assets/image/"+_settings.images.noEvent+"') no-repeat center",get("#containerImage").style.backgroundSize="cover",get("#screen").innerHTML+="<p>"+_content.events.noEvent+".</p>"}function spirit(){game.events.lastAction="spirit",game.stats.spiritMeet++;let e=rand(1,4);if(4==e)game.character.shield=game.character.shield+_settings.data.spiritShield,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.earthSpirit+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.spiritEarth_part1+".</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.spiritEarth_part2+" <strong>"+_settings.data.spiritShield+"</strong> "+plural(_settings.data.spiritShield,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+".</p>";else if(3==e){const e=rand(parseInt(game.character.xpTo/8),parseInt(game.character.xpTo/6));game.character.xp=game.character.xp+e,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.lightSpirit+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.spiritLight_part1+".</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.spiritLight_part2+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.spiritLight_part3+".</p>"}else 2==e?(game.character.strength=game.character.strength+_settings.data.spiritStrength,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.fireSpirit+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.spiritFire_part1+".</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.spiritFire_part2+" <strong>"+_settings.data.spiritStrength+"</strong> "+plural(_settings.data.spiritStrength,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+".</p>"):(game.character.healthMax=game.character.healthMax+_settings.data.spiritHealth,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.waterSpirit+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.spiritWater_part1+".</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.spiritWater_part2+" <strong>"+_settings.data.spiritHealth+"</strong> "+plural(_settings.data.spiritHealth,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+".</p>")}function merchant(){game.events.lastAction="merchant",get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.merchant+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.merchant+".</p>",game.character.itemMineral>1?(changeDisplay("normal-to-merchant"),get("#screen").innerHTML+="<p>"+_content.events.merchant_proposition+" ... </p>"):(game.events.subAction="merchantOver",get("#screen").innerHTML+="<p>"+_content.events.merchant_noMineral+" ...</p>")}function acceptMerchant(){game.events.subAction="merchantOver",game.stats.merchantAccepted++,playVibrate(90),playSound("Merchant"),changeDisplay("merchant-to-normal");const e=rand(1,3);3==e?(game.character.strength=game.character.strength+2,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.merchant+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.merchant_accepted+" !</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.merchant_offer1+".</p>"):2==e?(game.character.healthMax=game.character.healthMax+5,game.character.shield=game.character.shield+1,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.merchant+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.merchant_accepted+" !</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.merchant_offer2+".</p>"):3==e&&(get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.merchant+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.merchant_accepted+" !</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.merchant_offer3+".</p>"),game.character.itemMineral=game.character.itemMineral-2}function refuseMerchant(){game.events.subAction="merchantOver",game.stats.merchantRefused++,playVibrate(10),changeDisplay("merchant-to-normal"),get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.merchant+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.merchant+" ... </p>",get("#screen").innerHTML+="<p>"+_content.events.merchant_refused+" !</p>"}function chest(){game.events.lastAction="chest",changeDisplay("normal-to-chest"),get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.chest+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.chest+" !</p>"}function openChest(){game.events.subAction="chestOver",game.stats.chestOpen++,playVibrate(90),playSound("Chest"),changeDisplay("chest-to-normal");const e=rand(1,4);let t=!1;if(4==e){game.stats.chestTrap++;const e=rand(1,game.character.health/4);game.character.health=game.character.health-e,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.chestOpen+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.chestTrap_part1+" !</p>",get("#screen").innerHTML+='<p class="red">'+_content.events.chestTrap_part2+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.chestTrap_part3+".</p>"}else 3==e?(_settings.data.itemLimit>game.character.itemMineral?game.character.itemMineral++:t=!0,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.chestOpen+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.chestMineral+".</p>",t&&(get("#screen").innerHTML+="<p>"+_content.events.chestLimit+".</p>")):2==e?(_settings.data.itemLimit>game.character.itemMagic?game.character.itemMagic++:t=!0,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.chestOpen+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.chestMagic+".</p>",t&&(get("#screen").innerHTML+="<p>"+_content.events.chestLimit+".</p>")):(_settings.data.itemLimit>game.character.itemHeal?game.character.itemHeal++:t=!0,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.chestOpen+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.chestHeal+".</p>",t&&(get("#screen").innerHTML+="<p>"+_content.events.chestLimit+".</p>"))}function closeChest(){game.events.subAction="chestOver",game.stats.chestNotOpened++,playVibrate(10),changeDisplay("chest-to-normal"),get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+_settings.images.chest+'" alt=""></div>',get("#screen").innerHTML+="<p>"+_content.events.chest+" !</p>",get("#screen").innerHTML+="<p>"+_content.events.chest_notOpened+".</p>"}function fight(){game.events.lastAction="fight",game.events.monster=bestiary(),changeDisplay("normal-to-fight"),get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#screen").innerHTML+="<p><strong>"+game.events.monster[2]+"</strong> "+_content.events.fightStart+"</p>",get("#screen").innerHTML+="<p>"+_content.vocabulary.health+" : <strong>"+game.events.monster[0]+"</strong> / "+_content.vocabulary.strength+" : <strong>"+game.events.monster[1]+"</strong></p>"}function bestiary(){const e=rand(3*game.character.floor,5*game.character.floor);let t=parseInt(rand(e/4,e/3));return(0==t||t<0)&&(t=1),e>500?[e,t,_content.monsters.lich,_settings.images.monster17]:e>400?[e,t,_content.monsters.lightSword,_settings.images.monster16]:e>300?[e,t,_content.monsters.golem,_settings.images.monster15]:e>200?[e,t,_content.monsters.deadWarrior,_settings.images.monster14]:e>185?[e,t,_content.monsters.daemon,_settings.images.monster13]:e>170?[e,t,_content.monsters.minotaur,_settings.images.monster12]:e>155?[e,t,_content.monsters.cerberus,_settings.images.monster11]:e>140?[e,t,_content.monsters.troll,_settings.images.monster10]:e>125?[e,t,_content.monsters.eyeghost,_settings.images.monster09]:e>110?[e,t,_content.monsters.werewolf,_settings.images.monster08]:e>95?[e,t,_content.monsters.monster,_settings.images.monster07]:e>80?[e,t,_content.monsters.lizard,_settings.images.monster06]:e>65?[e,t,_content.monsters.gargoyle,_settings.images.monster05]:e>50?[e,t,_content.monsters.gobelin,_settings.images.monster04]:e>35?[e,t,_content.monsters.snake,_settings.images.monster03]:e>20?[e,t,_content.monsters.bat,_settings.images.monster02]:[e,t,_content.monsters.slim,_settings.images.monster01]}function attack(){game.events.subAction="fightOver",game.stats.fightVictory++,playVibrate(10),playSound("Attack"),changeDisplay("fight-to-normal");const e=Math.ceil(game.events.monster[0]/game.character.strength);let t=parseInt(e*game.events.monster[1])-game.character.shield;1==e&&(t=0),t<0&&(t=0),game.character.health=game.character.health-t;const a=rand(parseInt(game.character.xpTo/8),parseInt(game.character.xpTo/6));game.character.xp=game.character.xp+a,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#screen").innerHTML+="<p><strong>"+game.events.monster[2]+"</strong> "+_content.events.fightWin_part1+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.hit_singular,_content.vocabulary.hit_plural)+" !</p>",get("#screen").innerHTML+='<p class="red">'+_content.events.fightWin_part2+"<strong>"+t+"</strong> "+plural(t,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+" "+_content.events.fightWin_part3+".</p>",game.character.health>0&&(get("#screen").innerHTML+='<p class="green">'+_content.events.fightWin_part5+"<strong>"+a+"</strong> "+plural(a,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.fightWin_part4+".</p>")}function magic(){if(game.character.itemMagic>0){game.events.subAction="fightOver",game.character.itemMagic--,game.stats.fightVictory++,playVibrate(10),playSound("Magic"),changeDisplay("fight-to-normal");const e=parseInt(game.character.xpTo/8);game.character.xp=game.character.xp+e,get("#screen").innerHTML='<div id="containerImage"><img src="assets/image/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#screen").innerHTML+="<p>"+_content.events.fightMagic+".</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.fightWin_part5+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.fightWin_part4+".</p>"}else playVibrate(250)}function displayGame(){game.character.health<1?gameOver():(checkExperience(),checkInfo(),checkItems(),checkScore(),""!=get("#screen").innerHTML&&(game.events.currentEvent=get("#screen").innerHTML),setStorage("TOWER-save",JSON.stringify(game)))}function gameOver(){clearInterval(refreshDisplay),playVibrate(500),changeDisplay("screen-to-message"),get("#message").style.backgroundColor=getVariableCSS("background-gameover"),get("#message").innerHTML="<p>"+_content.events.gameover_part1+game.character.floor+".</p>",get("#message").innerHTML+='<p class="bigger">'+_content.events.gameover_part2+game.character.score+"</p>",get("#message").innerHTML+='<button class="button buttonAction" id="restart">'+_content.events.gameoverButton+"</button>",get("#restart").addEventListener("click",()=>{location.reload()}),resetGame()}function changeDisplay(e){"normal-game"==e&&(get("#chestMode").style.display="none",get("#merchantMode").style.display="none",get("#fightMode").style.display="none"),"normal-to-chest"==e&&(get("#classicMode").style.display="none",get("#chestMode").style.display="flex"),"chest-to-normal"==e&&(get("#classicMode").style.display="flex",get("#chestMode").style.display="none"),"normal-to-merchant"==e&&(get("#classicMode").style.display="none",get("#merchantMode").style.display="flex"),"merchant-to-normal"==e&&(get("#classicMode").style.display="flex",get("#merchantMode").style.display="none"),"normal-to-fight"==e&&(get("#classicMode").style.display="none",get("#fightMode").style.display="flex"),"fight-to-normal"==e&&(get("#classicMode").style.display="flex",get("#fightMode").style.display="none"),"screen-to-message"==e&&(get("~header").style.display="none",get("#game").style.display="none",get("#message").style.display="flex"),"message-to-screen"==e&&(get("~header").style.display="flex",get("#game").style.display="flex",get("#message").style.display="none")}function checkInfo(){get("#headerTitle").innerHTML=_content.vocabulary.floor+" "+game.character.floor+" - "+_content.vocabulary.room+" "+game.character.room,get("#healthData").innerHTML=game.character.health+" / "+game.character.healthMax,get("#health").style.width=100*game.character.health/game.character.healthMax+"%",get("#level").innerHTML=_content.vocabulary.level+" "+game.character.level,get("#xp").style.width=100*game.character.xp/game.character.xpTo+"%",get("#strength").innerHTML='<img src="assets/image/'+_settings.images.iconStrength+'" alt="">  '+game.character.strength,get("#shield").innerHTML='<img src="assets/image/'+_settings.images.iconShield+'" alt="">  '+game.character.shield}function checkItems(){game.character.itemHeal>0&&game.character.health!=game.character.healthMax?get("#useHeal").classList.remove("disabled"):get("#useHeal").classList.add("disabled"),game.character.itemMagic>0?get("#useMagic").classList.remove("disabled"):get("#useMagic").classList.add("disabled"),get("#potion").innerHTML='<img src="assets/image/'+_settings.images.iconPotion+'" alt=""> '+game.character.itemHeal,get("#magic").innerHTML='<img src="assets/image/'+_settings.images.iconMagic+'" alt=""> '+game.character.itemMagic,get("#mineral").innerHTML='<img src="assets/image/'+_settings.images.iconMineral+'" alt="">  '+game.character.itemMineral}function checkExperience(){game.character.xp>=game.character.xpTo&&(game.character.level++,game.character.strength=game.character.strength+_settings.data.lvlUpStrength,game.character.shield=game.character.shield+_settings.data.lvlUpShield,game.character.healthMax=game.character.healthMax+_settings.data.lvlUpHealth,game.character.health=game.character.healthMax,game.character.xp=0,game.character.xpTo=rand(parseInt(1.5*game.character.xpTo),2*game.character.xpTo),get("#screen").innerHTML+='<hr><p class="green"><strong>'+_content.events.levelUp_part1+"</strong>.</p>",get("#screen").innerHTML+='<p class="green">'+_content.events.levelUp_part2+".</p>")}function checkScore(){game.character.score=(game.character.strength+game.character.healthMax)*game.character.level*game.character.floor-30,game.character.score>game.stats.bestScore&&(game.stats.bestScore=game.character.score),game.character.floor>game.stats.bestFloor&&(game.stats.bestFloor=game.character.floor),game.character.level>game.stats.maxLevel&&(game.stats.maxLevel=game.character.level)}function checkSound(){game.core.sound?(game.core.sound=!1,get("#volumeButton").innerHTML=_settings.icons.soundOff,get("#volumeButton").style.opacity=.5):(game.core.sound=!0,get("#volumeButton").innerHTML=_settings.icons.soundOn,get("#volumeButton").style.opacity=1)}function checkVibrate(){game.core.vibrate?(game.core.vibrate=!1,get("#vibrateButton").innerHTML=_settings.icons.vibrateOff,get("#vibrateButton").style.opacity=.5):(game.core.vibrate=!0,get("#vibrateButton").innerHTML=_settings.icons.vibrateOn,get("#vibrateButton").style.opacity=1)}function checkStats(){let e=Object.values(_content.stats),t=Object.values(game.stats);for(let a=0;a<e.length;a++)0==a?get("#listStats").innerHTML="<li>"+e[a]+t[a]+"</li>":get("#listStats").innerHTML+="<li>"+e[a]+t[a]+"</li>"}function checkVersion(){game.core.version=_version,game.core.language||(game.core.language="EN"),game.character.itemMineral||(game.character.itemMineral=0),game.stats.merchantAccepted||(game.stats.merchantAccepted=0),game.stats.merchantRefused||(game.stats.merchantRefused=0),setStorage("TOWER-save",JSON.stringify(game))}function switchLanguage(){game.core.language="FR"==game.core.language?"EN":"FR",setStorage("TOWER-save",JSON.stringify(game)),location.reload()}function createMenu(){get("#openMenu").addEventListener("click",()=>{get("#blankMenu").style.display="block",get("#menu").style.display="flex",get("#closeMenu").style.visibility="visible",checkStats()}),get("#closeMenu").addEventListener("click",()=>{get("#closeMenu").style.visibility="hidden",get("#blankMenu").style.display="none",get("#menu").style.display="none"}),get("#blankMenu").addEventListener("click",()=>{get("#closeMenu").style.visibility="hidden",get("#blankMenu").style.display="none",get("#menu").style.display="none"}),get("#confirmRestart").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=_content.main.popupRestart,get("#popupCancel").addEventListener("click",()=>{get("#blankPopup").style.display="none",get("#popup").style.display="none"}),get("#popupAccept").addEventListener("click",()=>{clearInterval(refreshDisplay),game.core.ongoing=!1,resetGame(),location.reload()})}),get("#confirmDelete").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=_content.main.popupDelete,get("#popupCancel").addEventListener("click",()=>{get("#blankPopup").style.display="none",get("#popup").style.display="none"}),get("#popupAccept").addEventListener("click",()=>{clearInterval(refreshDisplay),remStorage("TOWER-save"),location.reload()})})}function createButtons(){get("#openMenu").style.visibility="visible",get("#volumeButton").addEventListener("click",checkSound),get("#vibrateButton").addEventListener("click",checkVibrate),game.core.sound?get("#volumeButton").innerHTML=_settings.icons.soundOn:(get("#volumeButton").innerHTML=_settings.icons.soundOff,get("#volumeButton").style.opacity=.5),game.core.vibrate?get("#vibrateButton").innerHTML=_settings.icons.vibrateOn:(get("#vibrateButton").innerHTML=_settings.icons.vibrateOff,get("#vibrateButton").style.opacity=.5),get("#useHeal").addEventListener("click",heal),get("#openChest").addEventListener("click",openChest),get("#closeChest").addEventListener("click",closeChest),get("#acceptOffer").addEventListener("click",acceptMerchant),get("#refuseOffer").addEventListener("click",refuseMerchant),get("#useAttack").addEventListener("click",attack),get("#useMagic").addEventListener("click",magic),get("#move").addEventListener("click",()=>{playVibrate(50),playTurn()})}function playSound(e){1==game.core.sound&&get("#sound"+e).play()}function playVibrate(e){1==game.core.vibrate&&navigator.vibrate(e)}function resetGame(){game.core.ongoing=!1,game.stats.totalGame++,game.character.health=_settings.data.health,game.character.healthMax=_settings.data.healthMax,game.character.strength=_settings.data.strength,game.character.shield=_settings.data.shield,game.character.xp=_settings.data.xp,game.character.xpTo=_settings.data.xpTo,game.character.itemHeal=_settings.data.itemHeal,game.character.itemMagic=_settings.data.itemMagic,game.character.itemMineral=_settings.data.itemMineral,game.character.level=_settings.data.level,game.character.floor=_settings.data.floor,game.character.room=_settings.data.room,setStorage("TOWER-save",JSON.stringify(game))}0==game.core.ongoing?launcher():startGame("load");