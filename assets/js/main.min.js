function launcher(){get("#startScreen").style.display="flex",get("#displayTip").innerHTML=_content.tips[rand(0,_content.tips.length)],null!=game.core.name&&""!=game.core.name?get("#nameHero").value=game.core.name:(get("#nameHero").value="",get("#nameHero").focus()),get("#startGame").addEventListener("click",function(){get("#nameHero").checkValidity()&&""!=get("#nameHero").value?startGame("new"):(get("#nameHeroLabel").innerHTML=_content.events.nameHeroCheck,get("#nameHeroLabel").style.color=getVariableCSS("errorTextColor"))})}function startGame(e){get("#startScreen").style.display="none",get("#gameScreen").style.display="flex",changeDisplay("actionGameMode"),createMenu(),createButtons(),checkVersion(),refreshDisplay=setInterval(displayGame,100),"new"==e?(game.core.name=get("#nameHero").value,game.core.ongoing=!0,playSound("Room"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.start+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.startGame_part1+".</p>",get("#gameContent").innerHTML+="<em>"+_content.events.startGame_part2+".</em>",get("#gameContent").innerHTML+="<p>"+_content.events.startGame_part3+".</p>"):"load"==e&&("fight"==game.events.lastAction&&"fightOver"!=game.events.subAction&&changeDisplay("actionGameToFight"),"chest"==game.events.lastAction&&"chestOver"!=game.events.subAction&&changeDisplay("actionGameToChest"),get("#gameContent").innerHTML=game.events.currentEvent)}function playTurn(){game.events.subAction=null,game.character.room++,changeDisplay("screenDisplayMessage"),game.character.room>10?(refreshInterval=2e3,game.character.room=1,game.character.floor++,playSound("Floor"),get("#gameMessage").innerHTML='<p class="bigger">'+_content.vocabulary.floor+" "+game.character.floor+"</p>"):(refreshInterval=1e3,game.stats.totalRoom++,playSound("Room"),get("#gameMessage").innerHTML='<p class="bigger">'+_content.vocabulary.floor+" "+parseInt(game.character.floor)+"</p>",get("#gameMessage").innerHTML+="<p>"+_content.vocabulary.room+" "+game.character.room+"</p>"),setTimeout(function(){changeDisplay("screenHideMessage")},refreshInterval),choiceAction()}function choiceAction(){let e=rand(1,9);e>7?(game.events.newAction="spirit",game.events.newAction!=game.events.lastAction?spirit():choiceAction()):e>4?(game.events.newAction="fight",game.events.newAction!=game.events.lastAction?fight():choiceAction()):e>2?(game.events.newAction="chest",game.events.newAction!=game.events.lastAction?chest():choiceAction()):(game.events.newAction="noEvent",game.events.newAction!=game.events.lastAction?noEvent():choiceAction())}function heal(){game.character.itemHeal>0&&game.character.health<game.character.healthMax?(game.character.itemHeal--,game.character.health=game.character.healthMax,game.stats.healUsed++,playVibrate(10),playSound("Heal"),get("#gameContent").innerHTML+='<hr><p class="green">'+_content.events.healing+"</p>"):playVibrate(250)}function noEvent(){game.events.lastAction="noEvent",get("#gameContent").innerHTML='<div id="containerImage"></div>',get("#containerImage").style.background="url('assets/images/"+_settings.images.noEvent+"') no-repeat center",get("#containerImage").style.backgroundSize="cover",get("#gameContent").innerHTML+="<p>"+_content.events.noEvent+".</p>"}function spirit(){game.events.lastAction="spirit",game.stats.spiritMeet++;let e=rand(1,8);if(e>6)game.character.shield=game.character.shield+_settings.data.spiritShield,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.earthSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.spiritEarth_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+_content.events.spiritEarth_part2+" <strong>"+_settings.data.spiritShield+"</strong> "+plural(_settings.data.spiritShield,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+".</p>";else if(e>4){const e=rand(parseInt(game.character.xpTo/8),parseInt(game.character.xpTo/6));game.character.xp=game.character.xp+e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.lightSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.spiritLight_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+_content.events.spiritLight_part2+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.spiritLight_part3+".</p>"}else e>2?(game.character.strength=game.character.strength+_settings.data.spiritStrength,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.fireSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.spiritFire_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+_content.events.spiritFire_part2+" <strong>"+_settings.data.spiritStrength+"</strong> "+plural(_settings.data.spiritStrength,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+".</p>"):(game.character.healthMax=game.character.healthMax+_settings.data.spiritHealth,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.waterSpirit+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.spiritWater_part1+".</p>",get("#gameContent").innerHTML+='<p class="green">'+_content.events.spiritWater_part2+" <strong>"+_settings.data.spiritHealth+"</strong> "+plural(_settings.data.spiritHealth,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+".</p>")}function chest(){game.events.lastAction="chest",changeDisplay("actionGameToChest"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.chest+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.chest+" !</p>"}function openChest(){game.events.subAction="chestOver",game.stats.chestOpen++,playVibrate(90),playSound("Chest"),changeDisplay("actionChestToGame");const e=rand(0,10);let t=!1;if(e>6){game.stats.chestTrap++;const e=rand(1,game.character.health/4);game.character.health=game.character.health-e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.chestTrap+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.chestTrap_part1+" !</p>",get("#gameContent").innerHTML+='<p class="red">'+_content.events.chestTrap_part2+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.chestTrap_part3+".</p>"}else e>3?(_settings.data.itemLimit>game.character.itemMagic?game.character.itemMagic++:t=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.chestMagic+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.chestMagic+".</p>",t&&(get("#gameContent").innerHTML+="<p>"+_content.events.chestLimit+".</p>")):(_settings.data.itemLimit>game.character.itemHeal?game.character.itemHeal++:t=!0,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.chestHeal+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.chestHeal+".</p>",t&&(get("#gameContent").innerHTML+="<p>"+_content.events.chestLimit+".</p>"))}function closeChest(){game.events.subAction="chestOver",game.stats.chestNotOpened++,playVibrate(10),changeDisplay("actionChestToGame"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+_settings.images.chest+'" alt=""></div>',get("#gameContent").innerHTML+="<p>"+_content.events.chest+" !</p>",get("#gameContent").innerHTML+="<p>"+_content.events.chest_notOpened+".</p>"}function fight(){game.events.lastAction="fight",game.events.monster=bestiary(),changeDisplay("actionGameToFight"),get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p><strong>"+game.events.monster[2]+"</strong> "+_content.events.fightStart+"</p>",get("#gameContent").innerHTML+="<p>"+_content.vocabulary.health+" : <strong>"+game.events.monster[0]+"</strong> / "+_content.vocabulary.strength+" : <strong>"+game.events.monster[1]+"</strong></p>"}function bestiary(){const e=rand(3*game.character.floor,6*game.character.floor);let t=parseInt(rand(e/4,e/3));return(0==t||t<0)&&(t=1),e>500?[e,t,_content.monsters.dragon,_settings.images.monster17]:e>450?[e,t,_content.monsters.supDemon,_settings.images.monster16]:e>400?[e,t,_content.monsters.bigSpirit,_settings.images.monster15]:e>350?[e,t,_content.monsters.deadWarrior,_settings.images.monster14]:e>290?[e,t,_content.monsters.troll,_settings.images.monster13]:e>240?[e,t,_content.monsters.behemot,_settings.images.monster12]:e>190?[e,t,_content.monsters.minotaur,_settings.images.monster11]:e>160?[e,t,_content.monsters.cerberus,_settings.images.monster10]:e>130?[e,t,_content.monsters.goblin,_settings.images.monster09]:e>100?[e,t,_content.monsters.ghost,_settings.images.monster08]:e>75?[e,t,_content.monsters.cockatrice,_settings.images.monster07]:e>50?[e,t,_content.monsters.lamia,_settings.images.monster06]:e>40?[e,t,_content.monsters.imp,_settings.images.monster05]:e>30?[e,t,_content.monsters.plant,_settings.images.monster04]:e>20?[e,t,_content.monsters.scorpio,_settings.images.monster03]:e>10?[e,t,_content.monsters.spider,_settings.images.monster02]:[e,t,_content.monsters.slim,_settings.images.monster01]}function attack(){game.events.subAction="fightOver",game.stats.fightVictory++,playVibrate(10),playSound("Attack"),changeDisplay("actionFightToGame");const e=Math.ceil(game.events.monster[0]/game.character.strength);let t=parseInt(e*game.events.monster[1])-game.character.shield;1==e&&(t=0),t<0&&(t=0),game.character.health=game.character.health-t;const a=rand(parseInt(game.character.xpTo/8),parseInt(game.character.xpTo/6));game.character.xp=game.character.xp+a,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p><strong>"+game.events.monster[2]+"</strong> "+_content.events.fightWin_part1+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.hit_singular,_content.vocabulary.hit_plural)+" !</p>",get("#gameContent").innerHTML+='<p class="red">'+_content.events.fightWin_part2+"<strong>"+t+"</strong> "+plural(t,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+" "+_content.events.fightWin_part3+".</p>",game.character.health>0&&(get("#gameContent").innerHTML+='<p class="green">'+_content.events.fightWin_part5+"<strong>"+a+"</strong> "+plural(a,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.fightWin_part4+".</p>")}function magic(){if(game.character.itemMagic>0){game.events.subAction="fightOver",game.character.itemMagic--,game.stats.fightVictory++,playVibrate(10),playSound("Magic"),changeDisplay("actionFightToGame");const e=parseInt(game.character.xpTo/8);game.character.xp=game.character.xp+e,get("#gameContent").innerHTML='<div id="containerImage"><img src="assets/images/'+game.events.monster[3]+'" alt="'+game.events.monster[2]+'"></div>',get("#gameContent").innerHTML+="<p>"+_content.events.fightMagic+".</p>",get("#gameContent").innerHTML+='<p class="green">'+_content.events.fightWin_part5+"<strong>"+e+"</strong> "+plural(e,_content.vocabulary.point_singular,_content.vocabulary.point_plural)+_content.events.fightWin_part4+".</p>"}else playVibrate(250)}function displayGame(){game.character.health<1?gameOver():(checkExperience(),checkInfo(),checkItems(),checkScore(),""!=get("#gameContent").innerHTML&&(game.events.currentEvent=get("#gameContent").innerHTML),setStorage("TOWER-save",JSON.stringify(game)))}function gameOver(){clearInterval(refreshDisplay),playVibrate(500),changeDisplay("actionGameMode"),get(".listActionsLine")[0].innerHTML='<button id="gameover">'+_content.events.results,get("#gameover").addEventListener("click",displayScore),get("#gameContent").innerHTML+='<p class="red"><strong>'+_content.events.death+"</strong></p>"}function displayScore(){changeDisplay("screenDisplayMessage"),get("#gameMessage").style.backgroundColor=getVariableCSS("gameoverBackground"),get("#gameMessage").innerHTML="<p>"+_content.events.gameover_part1+game.character.floor+".</p>",get("#gameMessage").innerHTML+='<p class="bigger">'+_content.events.gameover_part2+game.character.score+"</p>",get("#gameMessage").innerHTML+='<button id="restart">'+_content.events.gameoverButton+"</button>",get("#restart").addEventListener("click",()=>{location.reload()}),resetGame()}function changeDisplay(e){"actionGameMode"==e&&(get(".listActionsLine")[1].style.display="none",get(".listActionsLine")[2].style.display="none"),"actionGameToChest"==e&&(get(".listActionsLine")[0].style.display="none",get(".listActionsLine")[1].style.display="flex"),"actionChestToGame"==e&&(get(".listActionsLine")[0].style.display="flex",get(".listActionsLine")[1].style.display="none"),"actionGameToFight"==e&&(get(".listActionsLine")[0].style.display="none",get(".listActionsLine")[2].style.display="flex"),"actionFightToGame"==e&&(get(".listActionsLine")[0].style.display="flex",get(".listActionsLine")[2].style.display="none"),"screenDisplayMessage"==e&&(get("~header").style.display="none",get("#gameScreen").style.display="none",get("#gameMessage").style.display="flex"),"screenHideMessage"==e&&(get("~header").style.display="flex",get("#gameScreen").style.display="flex",get("#gameMessage").style.display="none")}function checkInfo(){get("#headerTitle").innerHTML=_content.vocabulary.floor+" "+game.character.floor+" - "+_content.vocabulary.room+" "+game.character.room,get("#health").innerHTML='<img src="assets/images/'+_settings.images.iconHealth+'" alt=""> '+game.character.health+" / "+game.character.healthMax,get("#level").innerHTML='<img src="assets/images/'+_settings.images.iconLevel+'" alt=""> '+game.character.level,get("#xp").innerHTML='<img src="assets/images/'+_settings.images.iconExperience+'" alt=""> '+game.character.xp+" / "+game.character.xpTo,get("#strength").innerHTML='<img src="assets/images/'+_settings.images.iconStrength+'" alt="">  '+game.character.strength,get("#shield").innerHTML='<img src="assets/images/'+_settings.images.iconShield+'" alt="">  '+game.character.shield}function checkItems(){game.character.itemHeal>0&&game.character.health!=game.character.healthMax?get("#useHeal").classList.remove("disabled"):get("#useHeal").classList.add("disabled"),game.character.itemMagic>0?get("#useMagic").classList.remove("disabled"):get("#useMagic").classList.add("disabled"),get("#potion").innerHTML='<img src="assets/images/'+_settings.images.iconPotion+'" alt=""> '+game.character.itemHeal,get("#magic").innerHTML='<img src="assets/images/'+_settings.images.iconMagic+'" alt=""> '+game.character.itemMagic}function checkExperience(){game.character.xp>=game.character.xpTo&&(game.character.level++,game.character.strength=game.character.strength+_settings.data.lvlUpStrength,game.character.shield=game.character.shield+_settings.data.lvlUpShield,game.character.healthMax=game.character.healthMax+_settings.data.lvlUpHealth,game.character.health=game.character.healthMax,game.character.xp=0,game.character.xpTo=rand(parseInt(1.5*game.character.xpTo),2*game.character.xpTo),get("#gameContent").innerHTML+='<hr><p class="green"><strong>'+_content.events.levelUp_part1+"</strong>.</p>",get("#gameContent").innerHTML+='<p class="green">'+_content.events.levelUp_part2+".</p>")}function checkScore(){game.character.score=(game.character.strength+game.character.healthMax)*game.character.level*game.character.floor-30,game.character.score>game.stats.bestScore&&(game.stats.bestScore=game.character.score),game.character.floor>game.stats.bestFloor&&(game.stats.bestFloor=game.character.floor),game.character.level>game.stats.maxLevel&&(game.stats.maxLevel=game.character.level)}function checkSound(){1==game.core.sound?(game.core.sound=!1,get("#volumeButton").innerHTML="ðŸ”ˆ"):(game.core.sound=!0,get("#volumeButton").innerHTML="ðŸ”Š")}function checkVibrate(){1==game.core.vibrate?(game.core.vibrate=!1,get("#vibrateButton").innerHTML="ðŸ“´"):(game.core.vibrate=!0,get("#vibrateButton").innerHTML="ðŸ“³")}function checkStats(){let e=Object.values(_content.stats),t=Object.values(game.stats);for(let a=0;a<e.length;a++)0==a?get("#listStats").innerHTML="<li>"+e[a]+t[a]+"</li>":get("#listStats").innerHTML+="<li>"+e[a]+t[a]+"</li>"}function checkVersion(){game.core.version!=_version&&(game.core.version=_version),setStorage("TOWER-save",JSON.stringify(game))}function createMenu(){get("#openMenu").addEventListener("click",()=>{get("#blankMenu").style.display="block",get("#menu").style.display="flex",get("#closeMenu").style.visibility="visible",checkStats()}),get("#closeMenu").addEventListener("click",()=>{get("#blankMenu").style.display="none",get("#menu").style.display="none",get("#closeMenu").style.visibility="hidden"}),get("#confirmRestart").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=_content.main.popupRestart,get("#popupCancel").addEventListener("click",()=>{get("#blankPopup").style.display="none",get("#popup").style.display="none"}),get("#popupAccept").addEventListener("click",()=>{clearInterval(refreshDisplay),game.core.ongoing=!1,resetGame(),location.reload()})}),get("#confirmDelete").addEventListener("click",()=>{get("#blankPopup").style.display="block",get("#popup").style.display="flex",get("#popupText").innerHTML=_content.main.popupDelete,get("#popupCancel").addEventListener("click",()=>{get("#blankPopup").style.display="none",get("#popup").style.display="none"}),get("#popupAccept").addEventListener("click",()=>{clearInterval(refreshDisplay),remStorage("TOWER-save"),location.reload()})})}function createButtons(){get("#openMenu").style.visibility="visible",get("#volumeButton").addEventListener("click",checkSound),get("#vibrateButton").addEventListener("click",checkVibrate),1==game.core.sound?get("#volumeButton").innerHTML="ðŸ”Š":get("#volumeButton").innerHTML="ðŸ”ˆ",1==game.core.vibrate?get("#vibrateButton").innerHTML="ðŸ“³":get("#vibrateButton").innerHTML="ðŸ“´",get("#useHeal").addEventListener("click",heal),get("#openChest").addEventListener("click",openChest),get("#closeChest").addEventListener("click",closeChest),get("#useAttack").addEventListener("click",attack),get("#useMagic").addEventListener("click",magic),get("#move").addEventListener("click",()=>{playVibrate(50),playTurn()})}function playSound(e){1==game.core.sound&&get("#sound"+e).play()}function playVibrate(e){1==game.core.vibrate&&navigator.vibrate(e)}function resetGame(){game.core.ongoing=!1,game.stats.totalGame++,game.character.health=_settings.data.health,game.character.healthMax=_settings.data.healthMax,game.character.strength=_settings.data.strength,game.character.shield=_settings.data.shield,game.character.xp=_settings.data.xp,game.character.xpTo=_settings.data.xpTo,game.character.itemHeal=_settings.data.itemHeal,game.character.itemMagic=_settings.data.itemMagic,game.character.level=_settings.data.level,game.character.floor=_settings.data.floor,game.character.room=_settings.data.room,setStorage("TOWER-save",JSON.stringify(game))}0==game.core.ongoing?launcher():startGame("load");